
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>T-Market</title>
<link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/moonspam/NanumSquare@2.0/nanumsquare.css">
<link rel="stylesheet" type="text/css" href="/css/page.css">

<script src="/js/menu.js"></script>
<script src="/js/item.js"></script>
<script src="/js/util/utils.js"></script>
<script src="/js/util/paging.js"></script>
<style>
#item-grid{
  background: #a5c23e;
}

table {
  border-collapse: collapse;
}

table td, table th {
  padding:0px;
  border: none;
  margin: 0px;
}

.content {
  height: auto;
  overflow-y: hidden;
  display: grid;
  grid-template-rows: auto 1fr;
  grid-template-columns: 150px auto;
  grid-template-areas:
      "navi1 navi1"
      "navi2 items";
  min-height: auto;
}

#itemNavi1{
  grid-area: navi1;
  display: flex;
  flex-direction: column;
  background: #619981;
  height: 50px;
}

#itemNavi2{
  grid-area: navi2;
  display: flex;
  flex-direction: row;
  background: #bdeed9;
}

#itemNavi2Wrap {
  float: left;
  background: #cf8e82;
}

#itemsDiv{
  grid-area: items;
  float: left;
  background: #959c7c;
}
</style>
</head>
<body>
  <div class="container">
  <div id="header">
    <div id="title"></div>
    <table>
      <tr>
        <td style="width:200px;">
          <div id="category"><i id="search-icon" class='fas fa-list-ul'></i> 전체 카테고리</div><div id="menuDiv"></div>
        </td>
        <td style="width:500px;">
          <div id="navi">
            특가 상품 | 상품 순위 | 즐겨찾기 | 쿠폰 
          </div>
        </td>
        <td style="width:300px; text-align: right; padding:2px 3px 0px 0px;">
          <div class="search-box">
            <input type="text" class="search-input" placeholder="Search">
            <button class="search-btn"><i class="fas fa-search"></i></button>
            <button class="search-btn"><i class="fas fa-filter"></i></button>
          </div>
        </td>
      </tr>
    </table>
  </div>
  <div class="content">
  <div id="itemNavi1">I t e m N a v i - !1</div>
  <div id="itemNavi2Wrap">
    <div id="itemNavi2">I t e m N a v i - !2</div>
  </div>
    <table id="itemDivWrap">
      <tr><td><div id="itemsDiv"></div></td></tr>
      <tr><td><div id="paging"></div></td></tr>
    </table>
  </div>
</div>
</body>

<script th:inline="javascript">
  const root = /*[[${root}]]*/ null;
  console.log("root:",root);
  let style = JSON.parse(root.style);
  function getRowCount() { return style.rows * style.cols };
  const itemsDiv = $("#itemsDiv");

  function createItemsDiv(path=root.path, nowPage=1, rowCount=getRowCount(),
                          maxPage=style.maxPage || 10, isAdd=style.isAdd) {
    console.log(path);
    if(!isAdd) itemsDiv.empty();
    $.get("/getPagingItems",{path:path,nowPage:nowPage,rowCount:rowCount,maxPage:maxPage})
    .done((data=>{
      data = JSON.parse(data);
      console.log(data);
      const grid = new ItemGrid(root.id, style);
      const items = data.items;
      grid.setItems(items);
      if(!isAdd){
        data.paging.defaultRowCount = getRowCount();
        $("#paging").empty().append(createPaging(data.paging, 
         (page)=>createItemsDiv(path,page,rowCount,maxPage),
         (rowCount)=>createItemsDiv(path,nowPage,rowCount,maxPage)));
      }
      itemsDiv.append(grid.div);
    })).fail(()=>console.log("Ajax Fail"));
  }

  

  function moveDetail(itemId) {
    $.getJSON("/getItemDetail", { id: itemId })
      .done((responseJson) => $("#itemDivWrap").empty().append(createItemDetail(responseJson)))
      .fail((xhr, status, error) => console.error("AJAX Error: " + status + " " + error));
  }

  function searchItems(path=root.path, nowPage=1, rowCount=getRowCount(),
                          maxPage=style.maxPage, filter) {
    itemsDiv.empty();
    $.get("/getSearchItems",{path:path,nowPage:nowPage,rowCount:rowCount,maxPage:maxPage,filter:filter})
    .done((data=>{
      data = JSON.parse(data);
      const grid = new ItemGrid(root.id, style);
      const items = data.items;
      grid.setItems(items);
      if(!isAdd){
        data.paging.defaultRowCount = getRowCount();
        $("#paging").empty().append(createPaging(data.paging, 
         (page)=>searchItems(path,page,rowCount,maxPage),
         (rowCount)=>searchItems(path,nowPage,rowCount,maxPage)));
      }
      itemsDiv.append(grid.div);
    })).fail(()=>console.log("Ajax Fail"));
  }

  function createItemDetail(item) {
    return $("<pre id='itemDetail'></pre>").html(JSON.stringify(item, null, 2));
  }

  $(()=>{
    $("#title").append(createTitle(root.name, "100%", 150, 45));
    // console.log("OFFSET",$("#category").offset().top, $("#category").offset().left);
    $("#menuDiv").css("top",190);
    createItemsDiv();
    createMenu((path)=>createItemsDiv(path,1,$("#rowCountSelect").val()))
  });
</script>

</html>